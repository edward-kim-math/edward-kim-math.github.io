<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Presentation Timer</title>
<style>
    html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: Arial, sans-serif;
    }
    body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: background-color 1s linear;
    }
    #controls {
        position: fixed;
        top: 10px;
        left: 10px;
        background: rgba(255,255,255,0.9);
        padding: 10px;
        border-radius: 6px;
        box-shadow: 0 0 5px #999;
        z-index: 10;
    }
    select {
        margin: 2px;
    }
    #display {
        text-align: center;
        font-size: 3em;
    }
    #progressContainer {
        width: 80%;
        height: 30px;
        border: 2px solid black;
        margin-top: 20px;
    }
    #progressBar {
        height: 100%;
        width: 0%;
        background-color: green;
        transition: width 1s linear;
    }
    #clock {
        position: fixed;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 1.8em;
        background: rgba(255,255,255,0.8);
        padding: 6px 12px;
        border-radius: 6px;
    }
</style>
</head>
<body>

<div id="controls">

    <div>
        <strong>Preset:</strong><br>
        <select id="presetSelect"></select>
    </div>

    <hr>

    <div>
        <strong>Start Time:</strong><br>
        <select id="startHour"></select> :
        <select id="startMinute"></select>
        <select id="startAMPM"></select>
    </div>

    <div style="margin-top:5px;">
        <strong>End Time:</strong><br>
        <select id="endHour"></select> :
        <select id="endMinute"></select>
        <select id="endAMPM"></select>
    </div>
</div>

<div id="display">Waiting...</div>
<div id="progressContainer">
    <div id="progressBar"></div>
</div>

<div id="clock">--:--:--</div>

<script>
// ===============================
// PRESET DEFINITIONS
// ===============================
const presets = [
    { label: "Custom...", start: null, end: null },
    { label: "7:45am – 8:40am", start: "7:45 AM", end: "8:40 AM" },
    { label: "8:50am – 9:45am", start: "8:50 AM", end: "9:45 AM" }
];

// ===============================

function populatePresetDropdown() {
    const sel = document.getElementById("presetSelect");
    presets.forEach((p, idx) => {
        let o = document.createElement("option");
        o.value = idx;
        o.text = p.label;
        sel.add(o);
    });

    sel.addEventListener("change", () => {
        const p = presets[sel.value];
        if(p.start && p.end) {
            applyTimeString("start", p.start);
            applyTimeString("end", p.end);
        }
    });
}

function populateTimeDropdowns() {
    const hours = [...Array(12)].map((_,i)=>i+1);
    const minutes = [...Array(60)].map((_,i)=>String(i).padStart(2,'0'));
    const ampm = ["AM","PM"];

    ["startHour","endHour"].forEach(id=>{
        const sel=document.getElementById(id);
        hours.forEach(h=>{
            let o=document.createElement("option");
            o.value=h;
            o.text=h;
            sel.add(o);
        });
    });

    ["startMinute","endMinute"].forEach(id=>{
        const sel=document.getElementById(id);
        minutes.forEach(m=>{
            let o=document.createElement("option");
            o.value=m;
            o.text=m;
            sel.add(o);
        });
    });

    ["startAMPM","endAMPM"].forEach(id=>{
        const sel=document.getElementById(id);
        ampm.forEach(a=>{
            let o=document.createElement("option");
            o.value=a;
            o.text=a;
            sel.add(o);
        });
    });

    const now = new Date();
    setDropdownFromDate("start", new Date(now.getTime()+60000));
    setDropdownFromDate("end", new Date(now.getTime()+21*60000));
}

function setDropdownFromDate(prefix, date) {
    let h = date.getHours();
    let ap = (h>=12) ? "PM" : "AM";
    h = h%12; if(h===0) h=12;
    document.getElementById(prefix+"Hour").value = h;
    document.getElementById(prefix+"Minute").value = String(date.getMinutes()).padStart(2,'0');
    document.getElementById(prefix+"AMPM").value = ap;
}

function applyTimeString(prefix, str) {
    let [time, ap] = str.split(" ");
    let [h, m] = time.split(":");
    document.getElementById(prefix+"Hour").value = parseInt(h);
    document.getElementById(prefix+"Minute").value = m;
    document.getElementById(prefix+"AMPM").value = ap;
}

function getTimeFromDropdown(prefix) {
    let h = parseInt(document.getElementById(prefix+"Hour").value);
    let m = parseInt(document.getElementById(prefix+"Minute").value);
    let ap = document.getElementById(prefix+"AMPM").value;
    if(ap==="PM" && h!==12) h+=12;
    if(ap==="AM" && h===12) h=0;
    let d = new Date();
    d.setHours(h,m,0,0);
    return d;
}

function formatMS(ms) {
    if(ms<0) ms=0;
    let totalSec = Math.floor(ms/1000);
    let min = Math.floor(totalSec/60);
    let sec = totalSec%60;
    return `${min}:${String(sec).padStart(2,'0')}`;
}

function formatClock(date) {
    let h = date.getHours();
    let m = date.getMinutes();
    let s = date.getSeconds();
    let ap = (h>=12) ? "PM" : "AM";
    h = h%12; if(h===0) h=12;
    return `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')} ${ap}`;
}

let flashState = false;

function updateTimer() {
    const now = new Date();
    let start = getTimeFromDropdown("start");
    let end = getTimeFromDropdown("end");

    if(end <= start) end = new Date(end.getTime()+24*60*60*1000);

    const display = document.getElementById("display");
    const progressBar = document.getElementById("progressBar");
    const body = document.body;
    const clock = document.getElementById("clock");

    // Always update current time display
    clock.textContent = formatClock(now);

    if(now < start) {
        display.textContent = "Starts in " + formatMS(start-now);
        progressBar.style.width="0%";
        body.style.backgroundColor="white";
        return;
    }

    if(now >= start && now <= end) {
        let elapsed = now-start;
        let total = end-start;
        let remaining = end-now;

        display.innerHTML =
            `Used: ${formatMS(elapsed)}<br>` +
            `Remaining: ${formatMS(remaining)}`;

        progressBar.style.width = (elapsed/total)*100 + "%";

        let tenMin = 10*60*1000;
        if(remaining > tenMin) {
            body.style.backgroundColor="white";
        } else {
            let t = 1 - (remaining/tenMin);
            let r = 255;
            let g = Math.floor(255*(1-t));
            body.style.backgroundColor = `rgb(${r},${g},0)`;
        }
        return;
    }

    display.textContent = "Presentation Ended";
    progressBar.style.width="100%";
    flashState = !flashState;
    body.style.backgroundColor = flashState ? "red" : "yellow";
}

// Initialize
populatePresetDropdown();
populateTimeDropdowns();
setInterval(updateTimer,1000);
updateTimer();
</script>
</body>
</html>
