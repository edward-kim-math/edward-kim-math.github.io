<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Presentation Timer</title>
<style>
    html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: Arial, sans-serif;
    }
    body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: background-color 1s linear;
    }
    #controls {
        position: fixed;
        top: 10px;
        left: 10px;
        background: rgba(255,255,255,0.9);
        padding: 10px;
        border-radius: 6px;
        box-shadow: 0 0 5px #999;
        z-index: 10;
    }
    select {
        margin: 2px;
    }

    #mainDisplay {
        width: 90%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 4em;
    }

    .timeBlock {
        width: 45%;
    }

    .label {
        font-size: 0.4em;
        margin-top: 10px;
    }

    #progressContainer {
        width: 97%;
        height: 30px;
        border: 2px solid black;
        margin-top: 30px;
    }
    #progressBar {
        height: 100%;
        width: 0%;
        background-color: green;
        transition: width 1s linear;
    }

    #message {
        font-size: 3em;
        text-align: center;
    }

    #clock {
        position: fixed;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 4em;
        background: rgba(255,255,255,0.8);
        padding: 6px 14px;
        border-radius: 6px;
    }
</style>
</head>
<body>

<div id="controls">

    <div>
        <strong>Preset:</strong><br>
        <select id="presetSelect"></select>
    </div>

    <hr>

    <div>
        <strong>Start Time:</strong><br>
        <select id="startHour"></select> :
        <select id="startMinute"></select>
        <select id="startAMPM"></select>
    </div>

    <div style="margin-top:5px;">
        <strong>End Time:</strong><br>
        <select id="endHour"></select> :
        <select id="endMinute"></select>
        <select id="endAMPM"></select>
    </div>
</div>

<div id="message">Waiting...</div>

<div id="mainDisplay">
    <div class="timeBlock" style="text-align:left;">
        <div id="usedTime">0:00</div>
        <div class="label">Used</div>
    </div>

    <div class="timeBlock" style="text-align:right;">
        <div id="remainingTime">0:00</div>
        <div class="label">Remaining</div>
    </div>
</div>

<div id="progressContainer">
    <div id="progressBar"></div>
</div>

<div id="clock">--:--:--</div>

<script>
// ===============================
// PRESET DEFINITIONS
// ===============================
const presets = [
    { label: "Custom...", start: null, end: null },

    { label: "7:45am – 8:40am (55 minutes)", start: "7:45 AM", end: "8:40 AM" },
    { label: "8:50am – 9:45am (55 minutes)", start: "8:50 AM", end: "9:45 AM" },
    { label: "9:55am – 10:50am (55 minutes)", start: "9:55 AM", end: "10:50 AM" },
    { label: "11:00am – 11:55am (55 minutes)", start: "11:00 AM", end: "11:55 AM" },
    { label: "12:05pm – 1:00pm (55 minutes)", start: "12:05 PM", end: "1:00 PM" },
    { label: "1:10pm – 2:05pm (55 minutes)", start: "1:10 PM", end: "2:05 PM" },
    { label: "2:15pm – 3:10pm (55 minutes)", start: "2:15 PM", end: "3:10 PM" },
    { label: "3:20pm – 4:15pm (55 minutes)", start: "3:20 PM", end: "4:15 PM" },
    { label: "4:25pm – 5:20pm (55 minutes)", start: "4:25 PM", end: "5:20 PM" },
    { label: "5:30pm – 6:25pm (55 minutes)", start: "5:30 PM", end: "6:25 PM" },
    // { label: "6:35pm – 7:30pm (55 minutes)", start: "6:35 PM", end: "7:30 PM" },
    // { label: "7:40pm – 8:35pm (55 minutes)", start: "7:40 PM", end: "8:35 PM" },

    //
    //
    { label: "85 minute presets", start: null, end: null },

    { label: "7:45am – 9:10am (85 minutes)", start: "7:45 AM", end: "9:10 AM" },
    { label: "9:25am – 10:50am (85 minutes)", start: "9:25 AM", end: "10:50 AM" },

    { label: "11:00am – 12:25pm (85 minutes)", start: "11:00 AM", end: "12:25 PM" },
    { label: "12:40pm – 2:05pm (85 minutes)", start: "12:40 PM", end: "2:05 PM" },

    { label: "2:15pm – 3:40pm (85 minutes)", start: "2:15 PM", end: "3:40 PM" },
    { label: "3:55pm – 5:20pm (85 minutes)", start: "3:55 PM", end: "5:20 PM" },

    { label: "5:30pm – 6:55pm (85 minutes)", start: "5:30 PM", end: "6:55 PM" },

];

// ===============================

function populatePresetDropdown() {
    const sel = document.getElementById("presetSelect");
    presets.forEach((p, idx) => {
        let o = document.createElement("option");
        o.value = idx;
        o.text = p.label;
        sel.add(o);
    });

    sel.addEventListener("change", () => {
        const p = presets[sel.value];
        if(p.start && p.end) {
            applyTimeString("start", p.start);
            applyTimeString("end", p.end);
        }
    });
}

function populateTimeDropdowns() {
    const hours = [...Array(12)].map((_,i)=>i+1);
    const minutes = [...Array(60)].map((_,i)=>String(i).padStart(2,'0'));
    const ampm = ["AM","PM"];

    ["startHour","endHour"].forEach(id=>{
        const sel=document.getElementById(id);
        hours.forEach(h=>{
            let o=document.createElement("option");
            o.value=h;
            o.text=h;
            sel.add(o);
        });
    });

    ["startMinute","endMinute"].forEach(id=>{
        const sel=document.getElementById(id);
        minutes.forEach(m=>{
            let o=document.createElement("option");
            o.value=m;
            o.text=m;
            sel.add(o);
        });
    });

    ["startAMPM","endAMPM"].forEach(id=>{
        const sel=document.getElementById(id);
        ampm.forEach(a=>{
            let o=document.createElement("option");
            o.value=a;
            o.text=a;
            sel.add(o);
        });
    });

    const now = new Date();
    setDropdownFromDate("start", new Date(now.getTime()+60000));
    setDropdownFromDate("end", new Date(now.getTime()+21*60000));
}

function setDropdownFromDate(prefix, date) {
    let h = date.getHours();
    let ap = (h>=12) ? "PM" : "AM";
    h = h%12; if(h===0) h=12;
    document.getElementById(prefix+"Hour").value = h;
    document.getElementById(prefix+"Minute").value = String(date.getMinutes()).padStart(2,'0');
    document.getElementById(prefix+"AMPM").value = ap;
}

function applyTimeString(prefix, str) {
    let [time, ap] = str.split(" ");
    let [h, m] = time.split(":");
    document.getElementById(prefix+"Hour").value = parseInt(h);
    document.getElementById(prefix+"Minute").value = m;
    document.getElementById(prefix+"AMPM").value = ap;
}

function getTimeFromDropdown(prefix) {
    let h = parseInt(document.getElementById(prefix+"Hour").value);
    let m = parseInt(document.getElementById(prefix+"Minute").value);
    let ap = document.getElementById(prefix+"AMPM").value;
    if(ap==="PM" && h!==12) h+=12;
    if(ap==="AM" && h===12) h=0;
    let d = new Date();
    d.setHours(h,m,0,0);
    return d;
}

function formatMS(ms) {
    if(ms<0) ms=0;
    let totalSec = Math.floor(ms/1000);
    let min = Math.floor(totalSec/60);
    let sec = totalSec%60;
    return `${min}:${String(sec).padStart(2,'0')}`;
}

function formatClock(date) {
    let h = date.getHours();
    let m = date.getMinutes();
    let s = date.getSeconds();
    let ap = (h>=12) ? "PM" : "AM";
    h = h%12; if(h===0) h=12;
    return `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')} ${ap}`;
}

let flashState = false;

function updateTimer() {
    const now = new Date();
    let start = getTimeFromDropdown("start");
    let end = getTimeFromDropdown("end");

    if(end <= start) end = new Date(end.getTime()+24*60*60*1000);

    const body = document.body;
    const clock = document.getElementById("clock");
    const message = document.getElementById("message");
    const usedEl = document.getElementById("usedTime");
    const remainEl = document.getElementById("remainingTime");
    const progressBar = document.getElementById("progressBar");

    // Always update clock
    clock.textContent = formatClock(now);

    if(now < start) {
        message.textContent = "Starts in " + formatMS(start-now);
        usedEl.textContent = "0:00";
        remainEl.textContent = formatMS(end-start);
        progressBar.style.width="0%";
        body.style.backgroundColor="white";
        return;
    }

    if(now >= start && now <= end) {
        message.textContent = "";

        let elapsed = now-start;
        let total = end-start;
        let remaining = end-now;

        usedEl.textContent = formatMS(elapsed);
        remainEl.textContent = formatMS(remaining);
        progressBar.style.width = (elapsed/total)*100 + "%";

        let tenMin = 10*60*1000;
        if(remaining > tenMin) {
            body.style.backgroundColor="white";
        } else {
            let t = 1 - (remaining/tenMin);
            let r = 255;
            let g = Math.floor(255*(1-t));
            body.style.backgroundColor = `rgb(${r},${g},0)`;
        }
        return;
    }

    // After end
    message.textContent = "Time's up, buddy!";
    usedEl.textContent = formatMS(end-start);
    remainEl.textContent = "0:00";
    progressBar.style.width="100%";
    flashState = !flashState;
    body.style.backgroundColor = flashState ? "red" : "yellow";
}

// Initialize
populatePresetDropdown();
populateTimeDropdowns();
setInterval(updateTimer,1000);
updateTimer();
</script>
</body>
</html>
